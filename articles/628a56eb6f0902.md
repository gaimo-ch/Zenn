---
title: "Raspberry Piã«Zabbix Serverã‚’æ§‹ç¯‰ã—ã¦ã‚µãƒ¼ãƒã¨IX2215ã‚’ç›£è¦–ã™ã‚‹ã‚ˆ"
emoji: "ğŸ‘ï¸"
type: "tech"
topics:
  - "raspberrypi"
  - "zabbix"
  - "ix2215"
published: true
published_at: "2023-09-18 02:13"
---

# ã¯ã˜ã‚ã«
*`Debian GNU/Linux 12 (bookworm)` `Zabbix Server 6.0` `Zabbix Agent2` `Apache2` `mariadb  Ver 15.1 Distrib 10.11.3-MariaDB` `NEC UNIVERGE IX2215`*
ç¾åœ¨ã€Proxmox VEã‚’ç”¨ã„ã¦LXCã‚³ãƒ³ãƒ†ãƒŠã‚’ç«‹ã¦ãŸã‚ŠVMã‚’ç«‹ã¦ãŸã‚Šã—ã¦éŠã‚“ã§ã„ã¾ã™ã€‚
ãƒ©ã‚ºãƒ‘ã‚¤ä½™ã£ã¦ã‚‹ã—ã€IXã‚‚ã‚ã‚‹ã—ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ç›£è¦–ã¨ã‹ã—ãŸã„ã€‚

ãƒ©ã‚ºãƒ‘ã‚¤ã«Zabbix Serverã‚’ç«‹ã¦ã€ç›£è¦–å¯¾è±¡ã§ã‚ã‚‹ã‚µãƒ¼ãƒã«Zabbix Agent2ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€IX2215ã®SNMPã‚’æœ‰åŠ¹åŒ–ã—ã¦ç›£è¦–ã—ã¾ã™ã€‚


# ğŸ› ç›£è¦–ã™ã‚‹å´ã®æº–å‚™ğŸ‘€

### Zabbix Server

https://www.zabbix.com/download?zabbix=6.0&os_distribution=raspberry_pi_os&os_version=12&components=server_frontend_agent&db=mysql&ws=apache
ãƒ©ã‚ºãƒ‘ã‚¤ã«Zabbixã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ç™»éŒ²ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãã¾ã™ã€‚
ä»Šå›ã¯bookwormã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ãŸãƒ©ã‚ºãƒ‘ã‚¤ã«å…¥ã‚Œã¾ã™ãŒã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«åˆã‚ã›ã¦ãã ã•ã„ã€‚
```sh
wget https://repo.zabbix.com/zabbix/6.0/raspbian/pool/main/z/zabbix-release/zabbix-release_6.0-5+debian12_all.deb
sudo dpkg -i zabbix-release_6.0-5+debian12_all.deb
sudo apt update
```
è«¸ã€…ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
```sh
sudo apt install zabbix-server-mysql zabbix-frontend-php zabbix-apache-conf zabbix-sql-scripts zabbix-agent2
```

### MariaDB

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è¨­å®šã‚’ã—ã¦ã„ãã¾ã™ã€‚
```sh
sudo apt install mariadb-server
```
```sh
sudo mariadb -uroot -p
MariaDB> create database zabbix character set utf8mb4 collate utf8mb4_bin;
MariaDB> create user ãƒ¦ãƒ¼ã‚¶ãƒ¼å@localhost identified by 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰';
MariaDB> grant all privileges on zabbix.* to ãƒ¦ãƒ¼ã‚¶ãƒ¼å@localhost;
MariaDB> set global log_bin_trust_function_creators = 1;
MariaDB> quit; 
```
ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚
```sh
zcat /usr/share/zabbix-sql-scripts/mysql/server.sql.gz | mysql --default-character-set=utf8mb4 -uãƒ¦ãƒ¼ã‚¶ãƒ¼å -p zabbix 
```
log_bin_trust_function_creatorsã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç„¡åŠ¹ã«æˆ»ã—ã¾ã™ã€‚
```sh
sudo mariadb -uroot -p
MariaDB> set global log_bin_trust_function_creators = 0;
MariaDB> quit; 
```

### ã‚³ãƒ³ãƒ•ã‚£ã‚°
`/etc/zabbix/zabbix_server.conf`ã«å…ˆç¨‹è¨­å®šã—ãŸã‚‚ã®ã«ç·¨é›†ã—ã¾ã™ã€‚
```:/etc/zabbix/zabbix_server.conf
DBName=ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å
DBUser=ãƒ¦ãƒ¼ã‚¶ãƒ¼å
DBPassword=ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
```

Agent2ã®ã‚³ãƒ³ãƒ•ã‚£ã‚°ã‚’ã„ã˜ã‚Šã¾ã™ã€‚
```:/etc/zabbix/zabbix_agent2.conf
Server=Zabbixã‚µãƒ¼ãƒã®IP
ServerActive=Zabbixã‚µãƒ¼ãƒã®IP
Hostname=WebGUIã§ç™»éŒ²ã™ã‚‹ãƒ›ã‚¹ãƒˆå
```

Serverã¨Agent2é–“ã®é€šä¿¡ã‚’PSKã§æš—å·åŒ–ã—ã¾ã™ã€‚
```sh
sudo su
openssl rand -hex 32 > /etc/zabbix/zabbix_agent2d.psk
```

`/etc/zabbix/zabbix_agent2.conf`ã«è¿½åŠ ã—ã¾ã™ã€‚
```:/etc/zabbix/zabbix_agent2.conf
TLSConnect=psk
TLSAccept=psk
TLSPSKIdentity=PSKã‚’è­˜åˆ¥ã™ã‚‹ãŸã‚ã®ä»»æ„ã®æ–‡å­—åˆ—
TLSPSKFile=/etc/zabbix/zabbix_agent2d.psk
```

### æ—¥æœ¬èªåŒ–
WebGUIã§æ—¥æœ¬èªã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã«ã€
```sh
sudo raspi-config
```
`Localisation Options` â†’ `Locale` â†’ `ja_JP.UTF-8 UTF-8`ã‚’é¸ã³ã¾ã™ã€‚
WebGUIã§æ–‡å­—åŒ–ã‘ã™ã‚‹ç®‡æ‰€ãŒã‚ã‚‹ã®ã§IPAãƒ•ã‚©ãƒ³ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
```sh
sudo apt install fonts-ipafont-gothic
```
ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’ä½œæˆã—ã¾ã™ã€‚
```sh
sudo ln -s /usr/share/fonts/opentype/ipafont-gothic/ipagp.ttf /usr/share/zabbix/assets/fonts/ipagp.ttf
ls -l /usr/share/zabbix/assets/fonts
lrwxrwxrwx 1 root root 38 Sep 16 06:42 graphfont.ttf -> /etc/alternatives/zabbix-frontend-font
lrwxrwxrwx 1 root root 50 Sep 17 13:44 ipagp.ttf -> /usr/share/fonts/opentype/ipafont-gothic/ipagp.ttf
```
`/usr/share/zabbix/include/defines.inc.php`ã‚’ã„ã˜ã‚Šã¾ã™ã€‚
```:/usr/share/zabbix/include/defines.inc.php
define('ZBX_GRAPH_FONT_NAME', 'graphfont');
define('ZBX_FONT_NAME', 'graphfont');

ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€â†“

define('ZBX_GRAPH_FONT_NAME', 'ipagp');
define('ZBX_FONT_NAME', 'ipagp');
```

### ä»•ä¸Šã’ã«...
Zabbix Serverã¨Agent2ã€Apache2ã‚’å†èµ·å‹•ã—ã€èµ·å‹•æ™‚ã«é–‹å§‹ã™ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚
```sh
sudo systemctl restart zabbix-server zabbix-agent2 apache2
sudo systemctl enable zabbix-server zabbix-agent2 apache2
```
å¿µã®ãŸã‚ã«å‹•ã„ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚
```sh
sudo systemctl status zabbix-server zabbix-agent2 apache2 
```

### WebGUI

WebGUIã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦è¨­å®šã—ã¦ã„ãã¾ã™ã€‚
```
http://ã‚µãƒ¼ãƒã®IP/zabbix
```
![](https://storage.googleapis.com/zenn-user-upload/f10a8d694cad-20230916.png)
å…ˆç¨‹è¨­å®šã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã€‚
![](https://storage.googleapis.com/zenn-user-upload/15ae3f8107c5-20230916.png)
ä»»æ„ã®ã‚µãƒ¼ãƒãƒ¼åã‚’å…¥åŠ›ã€‚
![](https://storage.googleapis.com/zenn-user-upload/928380d5857d-20230916.png)
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼å `Admin`, ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ `zabbix`ã¨ãªã£ã¦ã„ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/c81c2d2e4a02-20230917.png)
### æš—å·åŒ–ã‚’æœ‰åŠ¹ã«ã™ã‚‹
![](https://storage.googleapis.com/zenn-user-upload/df3f70420e84-20230917.png)
å…ˆç¨‹è¨­å®šã—ãŸIdentityã¨PSKã‚’å…¥åŠ›ã€‚
![](https://storage.googleapis.com/zenn-user-upload/a9ea47408b9b-20230917.png)

## ğŸ› ç›£è¦–ã•ã‚Œã‚‹å´ã®æº–å‚™ğŸ ğŸ’¬ã€€ğŸ‘€

åŒã˜ã‚ˆã†ã«ãƒªãƒã‚¸ãƒˆãƒªã‚’ç™»éŒ²ã—ã¦ã‹ã‚‰Agent2ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
â†“ã®ã¯Ubuntuå‘ã‘ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãªã®ã§å„è‡ªå¤‰æ›´ã—ã¦ãã ã•ã„ã€‚
```sh
wget https://repo.zabbix.com/zabbix/6.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_6.0-4+ubuntu22.04_all.deb
sudo dpkg -i zabbix-release_6.0-4+ubuntu22.04_all.deb
sudo apt update
sudo apt install zabbix-agent2
```

### ã‚³ãƒ³ãƒ•ã‚£ã‚°
Agent2ã®ã‚³ãƒ³ãƒ•ã‚£ã‚°ã‚’ã„ã˜ã‚Šã¾ã™ã€‚
```:/etc/zabbix/zabbix_agent2.conf
Server=Zabbixã‚µãƒ¼ãƒã®IP
ServerActive=Zabbixã‚µãƒ¼ãƒã®IP
Hostname=WebGUIã§ç™»éŒ²ã™ã‚‹ãƒ›ã‚¹ãƒˆå
```

Serverã¨Agent2é–“ã®é€šä¿¡ã‚’PSKã§æš—å·åŒ–ã—ã¾ã™ã€‚
```sh
sudo su
openssl rand -hex 32 > /etc/zabbix/zabbix_agent2d.psk
```

`/etc/zabbix/zabbix_agent2.conf`ã«è¿½åŠ ã—ã¾ã™ã€‚
```:/etc/zabbix/zabbix_agent2.conf
TLSConnect=psk
TLSAccept=psk
TLSPSKIdentity=PSKã‚’è­˜åˆ¥ã™ã‚‹ãŸã‚ã®ä»»æ„ã®æ–‡å­—åˆ—
TLSPSKFile=/etc/zabbix/zabbix_agent2d.psk
```
Agent2ã‚’å†èµ·å‹•ã—ã€èµ·å‹•æ™‚ã«é–‹å§‹ã™ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚
```sh
sudo systemctl restart zabbix-agent2
sudo systemctl enable zabbix-agent2
```

### ãƒ›ã‚¹ãƒˆä½œæˆ
ãƒ›ã‚¹ãƒˆã‚¿ãƒ–ã‹ã‚‰ç›£è¦–å¯¾è±¡ã‚’è¿½åŠ ã—ã¾ã™ã€‚
ãƒ›ã‚¹ãƒˆåã¯`/etc/zabbix/zabbix_agent2.conf`ã§è¨­å®šã—ãŸã‚‚ã®ã‚’å…¥åŠ›ã€‚
é©å½“ã«ãƒ†ãƒ³ãƒ—ãƒ¬ã¨ã‚°ãƒ«ãƒ¼ãƒ—ã‚’è¿½åŠ ã—ã¦ã„ãã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/e0abe5a45c2f-20230917.png)
ã“ã‚“ãªæ„Ÿã˜ã«ãªã£ãŸã‚‰ã‚ªãƒ¼ã‚±ãƒ¼ã§ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/845039f32276-20230918.png)


### IX2215
IX2215ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰SNMPã‚’æœ‰åŠ¹ã—ã¾ã™ã€‚
```
# config
(config)# snmp-agent ip enable
(config)# snmp-agent ip community ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£å ro
(config)# snmp-agent ip host ZabbixServerã®IP ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£å version 2
(config)# write memory
```

IXç”¨ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€`è¨­å®šâ†’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ`ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚
https://github.com/zabbix/community-templates/tree/main/Network_Devices/template_nec_univerge_ix/6.0
ãƒ›ã‚¹ãƒˆã‚’ç™»éŒ²ã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/0b4b7f786416-20230918.png)

### ãƒãƒƒãƒ—
Ctrlã‚­ãƒ¼æŠ¼ã—ãªãŒã‚‰ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã“ã¨ã§ãƒ›ã‚¹ãƒˆé–“ã«ãƒªãƒ³ã‚¯ã‚’ç¹‹ã’ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
`è¨­å®š` â†’ `ãƒ›ã‚¹ãƒˆ` â†’ `ã‚¢ã‚¤ãƒ†ãƒ `ã‹ã‚‰ã‚­ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦
ãƒªãƒ³ã‚¯ã®ãƒ©ãƒ™ãƒ«ã«
```
{?last(/ãƒ›ã‚¹ãƒˆå/ã‚­ãƒ¼)} 
```
ã‚’å…¥åŠ›ã™ã‚‹ã“ã¨ã§ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãªã©ã‚’ãƒãƒƒãƒ—ã«è¡¨ç¤ºã§ãã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/b6925ecf23f0-20230927.png)

## å‚è€ƒ
https://www.zabbix.com/documentation/3.0/en/manual/encryption/using_pre_shared_keys
https://www.ingenious.jp/articles/howto/zabbix-howto/zabbix-graph-garbled/
https://kusoneko.blogspot.com/2022/02/zabbix-ix2215-monitoring.html
https://bestmonitoringtools.com/create-zabbix-maps-with-examples/
