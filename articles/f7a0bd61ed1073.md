---
title: "CyberPowerã®UPSã‚’å°å…¥ã™ã‚‹ã‚ˆ"
emoji: "ğŸ”‹"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics:
  - "ups"
  - "linux"
  - "proxmox"
  - "raspberrypi"
published: false
---

[CyberPowerã®ç„¡åœé›»é›»æºè£…ç½®](https://www.cyberpower.com/jp/ja/product/sku/cp750pfclcd_jp)ã‚’è³¼å…¥ã—ãŸã®ã§ã€å¸¸æ™‚ç¨¼åƒã—ã¦ã„ã‚‹ãŠã†ã¡ã‚µãƒ¼ãƒã«å°å…¥ã—ã¾ã™ã€‚

# æ§‹æˆ

```mermaid
flowchart LR
  node_1(["UPS"])
  node_2["Proxmox\n[PowerPanel]"]
  node_3["Raspberry Pi"]
  node_1 --"åœé›»ã‚’æ¤œçŸ¥ï¼"--> node_2
  node_2 --"ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã—ã¦ï¼"--> node_3
  node_2 --"ã¼ãè‡ªèº«ã‚‚ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã™ã‚‹ãï¼"--> node_2
```

UPSãŒåœé›»ã‚’æ¤œçŸ¥ã—ãŸã‚‰ã€Proxmoxã«å¸¸é§ã—ã¦ã„ã‚‹PowerPanelãŒæ¤œçŸ¥ã—ã¦ã€Raspberry Piã«`poweroff`ã‚³ãƒãƒ³ãƒ‰ã‚’SSHã§é€ã‚Šã¾ã™ã€‚

# ğŸ›  æº–å‚™ã‚’ã—ã‚ˆã†

## Proxmox

Proxmoxä¸Šã®ãƒ›ã‚¹ãƒˆOSã«[PowerPanel for Linux 64bit (deb)](https://www.cyberpower.com/jp/ja/product/sku/powerpanel_for_linux#overview)ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```sh
sudo apt install ./CyberPower_PPL_Linux+64bit+(deb)_vãƒãƒ¼ã‚¸ãƒ§ãƒ³.deb
```

ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

```sh
sudo pwrstat -status
```

```sh
The UPS information shows as following:

        Properties:
                Model Name................... CP750PFCLCD JP
                Firmware Number.............. CR02207B5I13
                Rating Voltage............... 100 V
                Rating Power................. 525 Watt(750 VA)

        Current UPS status:
                State........................ Normal
                Power Supply by.............. Utility Power
                Utility Voltage.............. 96 V
                Output Voltage............... 96 V
                Battery Capacity............. 100 %
                Remaining Runtime............ 13 min.
                Load......................... 168 Watt(32 %)
                Line Interaction............. None
                Test Result.................. Unknown
                Last Power Event............. None
```

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã ã¨ã€åœé›»å¾Œã«å¾©æ—§ã—ã¦ã‚‚è¦å®šã®æ™‚é–“ã«UPSè‡ªä½“ãŒã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã•ã‚Œã¦ã—ã¾ã†ã®ã§ã€
`/etc/pwrstatd.conf`å†…ã®ä»¥ä¸‹ã®éƒ¨åˆ†ã‚’å¤‰æ›´ã—ã¾ã™ã€‚

```diff sh:/etc/pwrstatd.conf
-    turn-ups-off = yes
+    turn-ups-off = no
```

åœé›»ã‚’æ¤œçŸ¥ã™ã‚‹ã¨`/etc/shutdown.sh`ã‚’å®Ÿè¡Œã—ã¦ã‚·ã‚¹ãƒ†ãƒ ã‚’ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã™ã‚‹ã‚ˆã†ã§ã™ã€‚
